<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø§Ù„Ø·Ù„Ø¨Ø§Øª</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <style>
        body { font-family: 'Arial', sans-serif; background: #f0f2f5; margin: 0; padding: 20px; direction: rtl; }
        .main-container { max-width: 800px; margin: auto; background: #fff; padding: 20px; border-radius: 15px; box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .header-box { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 10px; margin-bottom: 20px; }
        .invoice-num { font-weight: bold; color: #e74c3c; font-size: 1.2em; }
        .customer-section { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px; text-align: right; }
        .info-group { display: flex; flex-direction: column; }
        label { font-weight: bold; margin-bottom: 5px; color: #555; }
        input, select, textarea { padding: 10px; border: 1px solid #ddd; border-radius: 8px; font-size: 15px; outline: none; }
        .add-box { background: #f9f9f9; padding: 15px; border-radius: 10px; display: flex; gap: 10px; align-items: flex-end; margin-bottom: 20px; }
        .btn-add { background: #222; color: #fff; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { padding: 12px; border-bottom: 1px solid #eee; text-align: center; }
        th { background: #f8f9fa; }
        .action-btns { display: flex; gap: 10px; margin-top: 20px; }
        .btn-pdf { background: #2e7d32; color: #fff; flex: 3; padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; font-size: 16px; }
        .btn-reset { background: #7f8c8d; color: #fff; flex: 1; padding: 15px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; }
        .btn-del { background: #f44336; color: white; border: none; padding: 5px 10px; border-radius: 4px; cursor: pointer; }
        .footer-date { margin-top: 30px; text-align: center; color: #888; font-size: 13px; }
        .no-print { display: none !important; }
    </style>
</head>
<body>

<div class="main-container" id="content-to-export">
    <div class="header-box">
        <h3>ğŸ‘¤ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ù„Ø¨</h3>
        <div class="invoice-num">Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©: #<span id="inv-id">1001</span></div>
    </div>

    <div class="customer-section">
        <div class="info-group">
            <label>Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„</label>
            <input type="text" id="cname">
        </div>
        <div class="info-group">
            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
            <input type="tel" id="cphone">
        </div>
        <div class="info-group">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
            <input type="text" id="address">
        </div>
        <div class="info-group">
            <label>Ø­Ø§Ù„Ø© Ø§Ù„Ø¯ÙØ¹</label>
            <select id="paymentStatus">
                <option value="ÙƒØ§Ø´ (Ù†Ù‚Ø¯)">ÙƒØ§Ø´ (Ù†Ù‚Ø¯)</option>
                <option value="Ø¢Ø¬Ù„ (Ø¯ÙŠÙ†)">Ø¢Ø¬Ù„ (Ø¯ÙŠÙ†)</option>
                <option value="ÙˆØ§ØµÙ„ (ØªÙ… Ø§Ù„Ø¯ÙØ¹)">ÙˆØ§ØµÙ„</option>
            </select>
        </div>
        <div class="info-group" style="grid-column: span 2;">
            <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <textarea id="note" rows="2"></textarea>
        </div>
    </div>

    <div class="add-box" id="input-area">
        <div style="flex: 2;">
            <label>ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</label>
            <input type="text" id="code" style="width: 100%;">
        </div>
        <div style="flex: 1;">
            <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
            <input type="number" id="qty" style="width: 100%;">
        </div>
        <button type="button" class="btn-add" onclick="addRow()">â• Ø¥Ø¶Ø§ÙØ©</button>
    </div>

    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>ÙƒÙˆØ¯ Ø§Ù„Ù…Ù†ØªØ¬</th>
                <th>Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                <th class="action-col">Ø­Ø°Ù</th>
            </tr>
        </thead>
        <tbody id="rows"></tbody>
    </table>

    <div class="footer-date">
        <p>ØªØ§Ø±ÙŠØ® Ø§Ù„Ø·Ù„Ø¨: <span id="current-date"></span></p>
    </div>
</div>

<div class="action-btns" style="max-width: 800px; margin: 15px auto;">
    <button type="button" class="btn-pdf" onclick="makePDF()">ğŸ“„ ØªØ­Ù…ÙŠÙ„ PDF</button>
    <button type="button" class="btn-reset" onclick="resetForm()">ğŸ”„ Ù…Ø³Ø­ Ø§Ù„ÙƒÙ„</button>
</div>

<script>
    let currentInvoiceNum = localStorage.getItem('invoiceNum') || 1001;
    document.getElementById('inv-id').innerText = currentInvoiceNum;
    document.getElementById('current-date').innerText = new Date().toLocaleDateString('ar-EG');

    var counter = 1;

    function addRow(){
        var code = document.getElementById("code").value.trim();
        var qty = document.getElementById("qty").value.trim();
        if(code === "" || qty === ""){ alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); return; }

        var tr = document.createElement("tr");
        tr.innerHTML = <td>${counter}</td><td>${code}</td><td>${qty}</td><td class="action-col"><button class="btn-del" onclick="this.parentElement.parentElement.remove()">âœ–</button></td>;
        document.getElementById("rows").appendChild(tr);
        counter++;
        document.getElementById("code").value = "";
        document.getElementById("qty").value = "";
    }

    function makePDF(){
        var cname = document.getElementById("cname").value.trim();
        if(cname === "") { alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„"); return; }

        document.getElementById('input-area').classList.add('no-print');
        document.querySelectorAll('.action-col').forEach(el => el.classList.add('no-print'));

        var element = document.getElementById('content-to-export');
        var opt = {
            margin: 0.5,
            filename: Order_${currentInvoiceNum}.pdf,
            image: { type: 'jpeg', quality: 0.98 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
        };

        html2pdf().set(opt).from(element).save().then(() => {
            document.getElementById('input-area').classList.remove('no-print');
            document.querySelectorAll('.action-col').forEach(el => el.classList.remove('no-print'));
            currentInvoiceNum++;
            localStorage.setItem('invoiceNum', currentInvoiceNum);
            document.getElementById('inv-id').innerText = currentInvoiceNum;
        });
    }

    function resetForm() {
        if(confirm("Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ")) {
            document.getElementById("cname").value = "";
            document.getElementById("rows").innerHTML = "";
            counter = 1;
        }
    }
</script>
</body>
</html>
